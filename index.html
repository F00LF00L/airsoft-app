<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Airsoft HQ - Tactical Free Maps</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Leaflet CSS & JS (Free Mapping Library) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body, html { height: 100%; margin: 0; padding: 0; background: #000; color: #fff; overflow: hidden; font-family: system-ui; }
        #map { height: 100%; width: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        .ui-overlay { position: absolute; z-index: 10; pointer-events: none; width: 100%; height: 100%; display: flex; flex-direction: column; }
        .ui-element { pointer-events: auto; }
        .glass { background: rgba(10, 10, 10, 0.85); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        
        .respawn-locked { 
            background: #1f2937 !important; 
            color: #4b5563 !important; 
            border: 2px solid #374151 !important;
            filter: grayscale(1);
            opacity: 0.7;
        }
        
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 5px; }
        .online { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        
        /* Pulse for User Location */
        .user-pulse {
            width: 12px;
            height: 12px;
            background: #3b82f6;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .leaflet-container { background: #000; }
    </style>
</head>
<body>

    <div id="map"></div>

    <div class="ui-overlay p-4 justify-between">
        <!-- Top Info Bar -->
        <div class="flex justify-between items-start ui-element">
            <div class="glass p-4 rounded-3xl min-w-[140px]">
                <div class="flex items-center mb-1">
                    <div id="gps-status" class="status-dot online"></div>
                    <span id="player-name-ui" class="text-[10px] font-black italic uppercase text-zinc-400">CONNECTING...</span>
                </div>
                <div id="dist-label" class="text-[10px] font-mono text-blue-400">BASE DIST: --m</div>
            </div>

            <div class="glass p-4 rounded-3xl text-center">
                <div id="match-timer" class="text-2xl font-black italic tabular-nums">10:00</div>
                <div class="text-[8px] font-bold text-zinc-500 uppercase tracking-tighter">Match Time</div>
            </div>
        </div>

        <!-- Center Alert -->
        <div id="lock-msg" class="self-center glass px-6 py-3 rounded-full text-red-500 font-bold text-[10px] uppercase tracking-[0.2em] hidden ui-element text-center">
            âš ï¸ OUT OF RESPAWN ZONE<br><span class="text-[8px] opacity-60">RETURN TO BASE TO DEPLOY</span>
        </div>

        <!-- Bottom Controls -->
        <div class="flex flex-col gap-3 ui-element">
            <div class="flex justify-between gap-3 h-14">
                <div class="flex-1 glass rounded-2xl flex items-center justify-center border-b-2 border-blue-600/30">
                    <span class="text-blue-500 font-black text-[10px] ml-2 font-mono">ALPHA</span>
                    <span id="score-a-ui" class="text-xl font-black">0</span>
                </div>
                <div class="flex-1 glass rounded-2xl flex items-center justify-center border-b-2 border-orange-600/30">
                    <span id="score-b-ui" class="text-xl font-black mr-2">0</span>
                    <span class="text-orange-500 font-black text-[10px] font-mono text-left">BRAVO</span>
                </div>
            </div>

            <button id="action-btn" class="w-full h-20 glass rounded-[2rem] flex flex-col items-center justify-center transition-all active:scale-95 border-2 border-white/10">
                <span id="action-icon" class="text-xl mb-1">ğŸ›¡ï¸</span>
                <span id="action-text" class="text-sm font-black italic uppercase tracking-widest">DEPLOYED</span>
            </button>

            <div id="admin-tools" class="hidden glass p-3 rounded-2xl flex justify-between items-center px-6">
                <button onclick="setBaseMode('A')" class="text-[9px] font-black text-blue-500 uppercase">Set A Base</button>
                <button onclick="toggleTimer()" class="text-zinc-500"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></button>
                <button onclick="setBaseMode('B')" class="text-[9px] font-black text-orange-500 uppercase">Set B Base</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDhNuddcNUbKdvJoKvtkJtca4M4OPwabug",
            authDomain: "airsoft-hq-e9bcd.firebaseapp.com",
            projectId: "airsoft-hq-e9bcd",
            storageBucket: "airsoft-hq-e9bcd.firebasestorage.app",
            messagingSenderId: "645394629676",
            appId: "1:645394629676:web:1fb768d52a0152b125fd89"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const roomID = new URLSearchParams(window.location.search).get('r') || 'tactical_hq';

        let map, myMarker, playerMarkers = {}, baseZones = { A: null, B: null };
        let currentPos = null, baseSetup = null;
        
        const uId = localStorage.getItem('as_id') || Math.random().toString(36).substring(7);
        localStorage.setItem('as_id', uId);
        const uName = localStorage.getItem('as_name') || "Operator";
        const uTeam = localStorage.getItem('as_team') || "A";

        let roomState = {
            adminId: null, players: {}, bases: { A: null, B: null },
            radius: 20, run: false, time: 600, sA: 0, sB: 0
        };

        function initMap() {
            // Initialize Leaflet Map
            map = L.map('map', { zoomControl: false }).setView([31.7683, 35.2137], 18);

            // Using free satellite imagery from Esri
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EBP, and the GIS User Community'
            }).addTo(map);

            // Tracking Location
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(updateGPS, handleError, {
                    enableHighAccuracy: true, maximumAge: 0, timeout: 5000
                });
            }

            map.on('click', (e) => {
                if(roomState.adminId === uId && baseSetup) {
                    roomState.bases[baseSetup] = { lat: e.latlng.lat, lng: e.latlng.lng };
                    baseSetup = null;
                    saveState();
                }
            });

            startSync();
        }

        function updateGPS(pos) {
            currentPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            
            if(!myMarker) {
                const icon = L.divIcon({ className: 'user-pulse' });
                myMarker = L.marker([currentPos.lat, currentPos.lng], { icon: icon }).addTo(map);
                map.setView([currentPos.lat, currentPos.lng]);
            } else {
                myMarker.setLatLng([currentPos.lat, currentPos.lng]);
            }

            if(roomState.players[uId]) {
                db.collection('airsoft_arena').doc(roomID).update({
                    [`players.${uId}.pos`]: currentPos,
                    [`players.${uId}.ts`]: Date.now()
                });
            }
            validateRespawn();
        }

        function validateRespawn() {
            const targetBase = roomState.bases[uTeam];
            if(!targetBase || !currentPos) return;

            const dist = map.distance([currentPos.lat, currentPos.lng], [targetBase.lat, targetBase.lng]);
            document.getElementById('dist-label').innerText = `BASE DIST: ${Math.round(dist)}m`;
            
            const isDead = roomState.players[uId]?.end > Date.now();
            const btn = document.getElementById('action-btn');
            const lock = document.getElementById('lock-msg');

            if(isDead) {
                if(dist <= roomState.radius) {
                    btn.classList.remove('respawn-locked');
                    btn.disabled = false;
                    lock.classList.add('hidden');
                    document.getElementById('action-text').innerText = "READY FOR RESPAWN";
                } else {
                    btn.classList.add('respawn-locked');
                    btn.disabled = true;
                    lock.classList.remove('hidden');
                    document.getElementById('action-text').innerText = "MOVE TO BASE";
                }
            }
        }

        function startSync() {
            db.collection('airsoft_arena').doc(roomID).onSnapshot(doc => {
                if(doc.exists) {
                    roomState = doc.data();
                    renderWorld();
                } else {
                    roomState.adminId = uId;
                    saveState();
                }
            });

            // Join the game in DB
            const joinData = { name: uName, team: uTeam, pos: null, end: 0, ts: Date.now() };
            db.collection('airsoft_arena').doc(roomID).update({ [`players.${uId}`]: joinData });
        }

        function renderWorld() {
            const isAdmin = roomState.adminId === uId;
            document.getElementById('admin-tools').classList.toggle('hidden', !isAdmin);
            document.getElementById('player-name-ui').innerText = (isAdmin ? "ğŸ‘‘ " : "") + uName;
            document.getElementById('score-a-ui').innerText = roomState.sA;
            document.getElementById('score-b-ui').innerText = roomState.sB;

            const m = Math.floor(roomState.time/60), s = roomState.time%60;
            document.getElementById('match-timer').innerText = `${m}:${s<10?'0':''}${s}`;

            const now = Date.now();
            Object.entries(roomState.players).forEach(([id, p]) => {
                if(id === uId) return;
                if(now - p.ts > 30000) {
                    if(playerMarkers[id]) { map.removeLayer(playerMarkers[id]); delete playerMarkers[id]; }
                    return;
                }
                if(!playerMarkers[id]) {
                    playerMarkers[id] = L.circleMarker([p.pos.lat, p.pos.lng], {
                        radius: 6, color: '#000', weight: 1, opacity: 1, fillOpacity: 1,
                        fillColor: p.team === 'A' ? '#3b82f6' : '#f97316'
                    }).addTo(map).bindTooltip(p.name, { permanent: true, direction: 'top', className: 'bg-transparent border-none text-[8px] text-white shadow-none' });
                }
                if(p.pos) playerMarkers[id].setLatLng([p.pos.lat, p.pos.lng]);
                playerMarkers[id].setStyle({ fillOpacity: p.end > now ? 0.2 : 1 });
            });

            ['A', 'B'].forEach(t => {
                const b = roomState.bases[t];
                if(b) {
                    if(!baseZones[t]) {
                        baseZones[t] = L.circle([b.lat, b.lng], {
                            radius: roomState.radius, color: t==='A'?'#3b82f6':'#f97316', weight: 1, fillOpacity: 0.1
                        }).addTo(map);
                    }
                    baseZones[t].setLatLng([b.lat, b.lng]);
                }
            });

            updateMainButton();
        }

        function updateMainButton() {
            const isDead = roomState.players[uId]?.end > Date.now();
            const btn = document.getElementById('action-btn');
            if(isDead) {
                btn.style.borderColor = "#ef4444";
                document.getElementById('action-icon').innerText = "ğŸ’€";
                validateRespawn();
            } else {
                btn.style.borderColor = "rgba(255,255,255,0.1)";
                btn.classList.remove('respawn-locked');
                btn.disabled = false;
                document.getElementById('action-icon').innerText = "ğŸ›¡ï¸";
                document.getElementById('action-text').innerText = "OPERATIONAL";
                document.getElementById('lock-msg').classList.add('hidden');
            }
        }

        document.getElementById('action-btn').onclick = () => {
            const now = Date.now();
            const p = roomState.players[uId];
            if(p.end > now) {
                p.end = 0;
            } else {
                p.end = now + (30 * 1000); // 30s penalty
                if(uTeam === 'A') roomState.sB++; else roomState.sA++;
            }
            saveState();
        };

        window.setBaseMode = (team) => {
            baseSetup = team;
            alert(`×œ×—×¥ ×¢×œ ×”××¤×” ×›×“×™ ×œ×”×¦×™×‘ ××ª ×‘×¡×™×¡ ${team === 'A' ? '××œ×¤×' : '×‘×¨××‘×•'}`);
        };

        function handleError(e) { console.error("GPS Error", e); }
        function saveState() { db.collection('airsoft_arena').doc(roomID).set(roomState); }

        window.onload = initMap;
    </script>
</body>
</html>

lor" stroke-width="2"><path d="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3M4 7h16"/></svg>
        </button>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDhNuddcNUbKdvJoKvtkJtca4M4OPwabug",
            authDomain: "airsoft-hq-e9bcd.firebaseapp.com",
            projectId: "airsoft-hq-e9bcd",
            storageBucket: "airsoft-hq-e9bcd.firebasestorage.app",
            messagingSenderId: "645394629676",
            appId: "1:645394629676:web:1fb768d52a0152b125fd89"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let userLocal = {
            name: localStorage.getItem('as_name'),
            team: localStorage.getItem('as_team'),
            id: localStorage.getItem('as_id') || Math.random().toString(36).substring(7)
        };
        if(!localStorage.getItem('as_id')) localStorage.setItem('as_id', userLocal.id);

        let activeTeamSelection = null;
        let editingPlayerId = null;
        let state = {
            adminId: null, run: false, time: 600, resp: 30, sA: 0, sB: 0, players: {}, history: [], ts: Date.now()
        };

        const roomID = new URLSearchParams(window.location.search).get('r') || 'combat_lobby';
        document.getElementById('roomLabel').innerText = "HQ: " + roomID.replace(/_/g, ' ');

        if(userLocal.name && userLocal.team) {
            document.getElementById('loginScreen').classList.add('hidden');
            joinGame();
        }

        window.pickTeam = (t) => {
            activeTeamSelection = t;
            document.getElementById('pickA').style.borderColor = t==='A' ? '#3b82f6' : '#27272a';
            document.getElementById('pickB').style.borderColor = t==='B' ? '#f97316' : '#27272a';
        };

        window.confirmEntry = () => {
            const name = document.getElementById('inputName').value.trim();
            if(!name || !activeTeamSelection) return;
            userLocal.name = name; userLocal.team = activeTeamSelection;
            localStorage.setItem('as_name', name);
            localStorage.setItem('as_team', activeTeamSelection);
            document.getElementById('loginScreen').classList.add('hidden');
            joinGame();
        };

        async function joinGame() {
            const ref = db.collection('airsoft_arena').doc(roomID);
            const doc = await ref.get();
            let d = doc.exists ? doc.data() : state;
            
            if(!d.adminId) d.adminId = userLocal.id;
            
            d.players[userLocal.id] = { 
                name: userLocal.name, 
                team: userLocal.team, 
                end: 0, 
                hits: 0,
                lastSeen: Date.now() 
            };
            d.ts = Date.now();
            await ref.set(d);
            connect();
        }

        async function connect() {
            try {
                await auth.signInAnonymously();
                db.collection('airsoft_arena').doc(roomID).onSnapshot(doc => {
                    if(doc.exists) {
                        const d = doc.data();
                        if(d.ts >= state.ts) state = d;
                        render();
                    }
                }, err => {
                    document.getElementById('connStatus').className = "w-2.5 h-2.5 rounded-full bg-red-600";
                });
            } catch(e) {}
        }

        window.claimAdmin = () => {
            state.adminId = userLocal.id;
            sync();
        };

        function render() {
            document.getElementById('txtScoreA').innerText = state.sA;
            document.getElementById('txtScoreB').innerText = state.sB;
            const m = Math.floor(state.time/60), s = state.time%60;
            document.getElementById('txtTimer').innerText = `${m}:${s<10?'0':''}${s}`;
            document.getElementById('iconPlay').innerHTML = state.run ? '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>' : '<path d="M8 5v14l11-7z"/>';
            document.getElementById('connStatus').className = "w-2.5 h-2.5 rounded-full bg-green-500 shadow-[0_0_8px_#22c55e]";
            
            const isAdmin = state.adminId === userLocal.id;
            const adminActive = state.players[state.adminId] && (Date.now() - state.players[state.adminId].lastSeen < 15000);

            if(isAdmin) document.body.classList.add('is-admin'); 
            else document.body.classList.remove('is-admin');

            document.getElementById('btnClaimAdmin').classList.toggle('hidden', isAdmin || adminActive);

            const myP = state.players[userLocal.id];
            document.getElementById('userLabel').innerText = (isAdmin ? "ğŸ‘‘ " : "") + userLocal.name;
            document.getElementById('userLabel').className = `text-[10px] font-black uppercase italic ${myP?.team==='A'?'text-blue-500':'text-orange-500'}`;

            renderGrids(isAdmin);
        }

        function renderGrids(isAdmin) {
            const alpha = document.getElementById('gridAlpha');
            const bravo = document.getElementById('gridBravo');
            alpha.innerHTML = ''; bravo.innerHTML = '';
            const now = Date.now();

            Object.entries(state.players).forEach(([id, p]) => {
                const isDead = p.end > now;
                const isMe = id === userLocal.id;
                const card = document.createElement('div');
                card.dataset.id = id;
                card.className = `player-card glass ${isDead?'is-dead':''} ${isMe?'is-me':''} ${!state.run?'opacity-50':''}`;
                
                if(isDead) {
                    const sec = Math.ceil((p.end - now)/1000);
                    card.innerHTML = `<span class="text-3xl font-black italic tabular-nums">${sec}</span><span class="text-[8px] uppercase opacity-40">${p.name} (${p.hits || 0})</span>`;
                } else {
                    card.innerHTML = `
                        <div class="absolute top-2 right-3 text-[9px] font-black opacity-30 italic tabular-nums">${p.hits || 0} HITS</div>
                        <span class="font-black text-sm uppercase ${p.team==='A'?'text-blue-500':'text-orange-500'}">${p.name}</span>
                        ${isAdmin ? '<div class="mt-1 text-[7px] font-bold text-zinc-500 border border-zinc-800 px-1.5 rounded edit-btn">SQUAD LEAD</div>' : ''}
                    `;
                }

                card.onclick = (e) => {
                    if(e.target.classList.contains('edit-btn')) { openEdit(id); return; }
                    if(!isMe || !state.run || isDead) return;
                    p.end = Date.now() + (state.resp * 1000);
                    p.hits = (p.hits || 0) + 1;
                    if(p.team === 'A') state.sB++; else state.sA++;
                    sync();
                };

                if(p.team === 'A') alpha.appendChild(card); else bravo.appendChild(card);
            });

            if(isAdmin) setupSortable();
        }

        function setupSortable() {
            const opt = { group: 'players', animation: 150, ghostClass: 'drag-ghost', onEnd: (e) => {
                const id = e.item.dataset.id;
                const newT = e.to.id === 'gridAlpha' ? 'A' : 'B';
                if(state.players[id].team !== newT) { state.players[id].team = newT; sync(); }
            }};
            if(!window.sA) window.sA = Sortable.create(document.getElementById('gridAlpha'), opt);
            if(!window.sB) window.sB = Sortable.create(document.getElementById('gridBravo'), opt);
        }

        window.openEdit = (id) => {
            editingPlayerId = id;
            document.getElementById('editPlayerName').value = state.players[id].name;
            document.getElementById('editPlayerTeam').value = state.players[id].team;
            document.getElementById('editModal').classList.remove('hidden');
        };
        window.closeEdit = () => document.getElementById('editModal').classList.add('hidden');
        window.saveEdit = () => {
            state.players[editingPlayerId].name = document.getElementById('editPlayerName').value;
            state.players[editingPlayerId].team = document.getElementById('editPlayerTeam').value;
            sync(); closeEdit();
        };
        window.kickPlayer = () => {
            if(confirm("Kick player?")) { delete state.players[editingPlayerId]; sync(); closeEdit(); }
        };

        window.applySettings = () => {
            const roomN = document.getElementById('newRoomName').value.trim();
            const resp = parseInt(document.getElementById('setRespTime').value);
            const match = parseInt(document.getElementById('setMatchTime').value);
            
            state.resp = resp || 30;
            state.time = (match || 10) * 60;
            sync();

            if(roomN && roomN.toLowerCase() !== roomID) {
                window.location.search = `?r=${roomN.toLowerCase().replace(/\s+/g, '_')}`;
            } else {
                document.getElementById('roomDialog').classList.add('hidden');
            }
        };

        window.hardResetRoom = () => {
            if(confirm("×›×œ ×”× ×ª×•× ×™× ×•×”×©×—×§× ×™× ×™×™××—×§×• ××”×—×“×¨. ×‘×˜×•×—?")) {
                state.players = {}; state.history = [];
                state.sA = 0; state.sB = 0; state.time = 600; state.run = false;
                state.adminId = userLocal.id;
                sync();
                window.location.reload();
            }
        };

        function sync() { state.ts = Date.now(); db.collection('airsoft_arena').doc(roomID).set(state); }

        window.toggleHistory = () => {
            const p = document.getElementById('historyPanel');
            if(p.classList.contains('hidden')) {
                const list = document.getElementById('historyList'); list.innerHTML = '';
                if(state.history.length === 0) document.getElementById('noHistory').classList.remove('hidden');
                else {
                    document.getElementById('noHistory').classList.add('hidden');
                    state.history.slice().reverse().forEach(h => {
                        const div = document.createElement('div');
                        div.className = "glass p-6 rounded-3xl border-white/5";
                        let stats = Object.values(h.playerData || {}).map(ps => `<div class="flex justify-between text-[11px] border-b border-white/5 py-1">
                                <span class="${ps.team==='A'?'text-blue-500':'text-orange-500'}">${ps.name}</span>
                                <span class="text-zinc-500">${ps.hits} Hits</span></div>`).join('');
                        div.innerHTML = `<div class="flex justify-between mb-4"><span class="text-xs font-black text-zinc-600">RND ${h.round}</span>
                                <span class="text-[10px] font-black uppercase ${h.winner==='ALPHA'?'text-blue-500':'text-orange-500'}">${h.winner} WIN</span></div>
                                <div class="flex justify-around mb-4 text-2xl font-black italic"><span>${h.sA}</span><span class="text-zinc-800 text-sm italic">VS</span><span>${h.sB}</span></div>
                                <div class="bg-black/40 rounded-xl p-3">${stats}</div>`;
                        list.appendChild(div);
                    });
                }
            }
            p.classList.toggle('hidden');
        };

        window.endRound = () => {
            if(!confirm("×¡×™×™× ×¡×™×‘×•×‘ ×•×©××•×¨ ×“×•''×— ×§×¨×‘?")) return;
            const w = state.sA > state.sB ? 'ALPHA' : (state.sB > state.sA ? 'BRAVO' : 'DRAW');
            const pData = {}; Object.entries(state.players).forEach(([id, p]) => pData[id] = { name: p.name, team: p.team, hits: p.hits });
            state.history.push({ round: state.history.length+1, sA: state.sA, sB: state.sB, winner: w, playerData: pData });
            resetStats(false); toggleHistory();
        };

        window.resetStats = (ask=true) => {
            if(ask && !confirm("××™×¤×•×¡ ×ª×•×¦××•×ª ×•×–×× ×™×?")) return;
            state.sA = 0; state.sB = 0; state.run = false;
            Object.values(state.players).forEach(p => { p.end = 0; p.hits = 0; });
            sync();
        };

        window.copyShareLink = () => {
            const t = document.createElement('textarea'); t.value = window.location.href; document.body.appendChild(t);
            t.select(); document.execCommand('copy'); document.body.removeChild(t); alert("Room link copied!");
        };

        document.getElementById('btnMainToggle').onclick = () => { if(state.adminId===userLocal.id){ state.run=!state.run; sync(); }};

        setInterval(() => {
            if(state.run && state.time > 0) {
                state.time--;
                if(state.time === 0) endRound();
                render();
            }
            // Update presence & periodic sync
            if(state.players[userLocal.id]) {
                state.players[userLocal.id].lastSeen = Date.now();
                if(Date.now() % 5000 < 1000) sync();
            }
        }, 1000);

        window.onload = () => {
            document.getElementById('setRespTime').value = state.resp;
            document.getElementById('setMatchTime').value = state.time / 60;
        };
    </script>
</body>
</html>

