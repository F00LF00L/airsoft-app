<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Airsoft HQ Pro - Tactical Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body, html { height: 100%; margin: 0; padding: 0; background: #050505; color: #eee; overflow: hidden; font-family: system-ui; }
        #map { height: 100%; width: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        .ui-overlay { position: absolute; z-index: 10; pointer-events: none; width: 100%; height: 100%; display: flex; flex-direction: column; }
        .ui-element { pointer-events: auto; }
        .glass { background: rgba(15, 15, 15, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        
        /* Respawn Logic Styles */
        .is-locked { background: #1a1a1a !important; color: #444 !important; border-color: #333 !important; filter: grayscale(1); }
        .is-dead { border-color: #ef4444 !important; box-shadow: 0 0 15px rgba(239, 68, 68, 0.2); }
        
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 5px; transition: 0.3s; }
        .online { background: #22c55e; box-shadow: 0 0 8px #22c55e; }
        
        .user-pulse {
            width: 14px; height: 14px; background: white; border: 3px solid #3b82f6;
            border-radius: 50%; box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        /* Modal / Panel Styles */
        .panel-slide { transition: transform 0.3s ease-in-out; }
        .panel-hidden { transform: translateY(100%); }
    </style>
</head>
<body>

    <div id="map"></div>

    <!-- UI LAYER -->
    <div class="ui-overlay p-4 justify-between">
        
        <!-- Header: Stats & Timer -->
        <div class="flex justify-between items-start ui-element">
            <div class="glass p-3 rounded-2xl min-w-[140px]">
                <div class="flex items-center mb-1">
                    <div id="gps-indicator" class="status-dot online"></div>
                    <span id="player-label" class="text-[10px] font-black uppercase text-zinc-400">CONNECTING...</span>
                </div>
                <div id="distance-label" class="text-[9px] font-mono text-blue-400 uppercase">BASE: --m</div>
            </div>

            <div class="glass p-3 px-6 rounded-2xl text-center flex flex-col items-center">
                <div id="display-timer" class="text-2xl font-black italic tracking-tighter tabular-nums">10:00</div>
                <div id="game-status-label" class="text-[7px] font-bold text-zinc-500 uppercase">WAITING FOR ADMIN</div>
            </div>

            <button onclick="toggleAdminPanel()" class="glass p-3 rounded-2xl ui-element">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM12 14v2M12 8v2"/></svg>
            </button>
        </div>

        <!-- Center: Geofence Lock Message -->
        <div id="geofence-alert" class="self-center glass px-6 py-4 rounded-3xl text-red-500 font-bold text-[10px] uppercase tracking-widest hidden ui-element text-center animate-pulse">
            ‚ö†Ô∏è OUT OF RESPAWN ZONE<br>
            <span class="text-zinc-500 text-[8px] mt-1 block">RETURN TO BASE TO ACTIVATE RESPAWN</span>
        </div>

        <!-- Bottom: Scoring & Main Button -->
        <div class="flex flex-col gap-3 ui-element">
            
            <div class="flex justify-between gap-3 h-14">
                <div class="flex-1 glass rounded-2xl flex items-center justify-center border-b-2 border-blue-600/30">
                    <span class="text-blue-500 font-black text-[10px] ml-2">ALPHA</span>
                    <span id="score-a" class="text-xl font-black italic">0</span>
                </div>
                <div class="flex-1 glass rounded-2xl flex items-center justify-center border-b-2 border-orange-600/30">
                    <span id="score-b" class="text-xl font-black italic mr-2">0</span>
                    <span class="text-orange-500 font-black text-[10px]">BRAVO</span>
                </div>
            </div>

            <button id="main-btn" class="w-full h-20 glass rounded-[2rem] flex flex-col items-center justify-center transition-all active:scale-95 border-2 border-white/10 overflow-hidden relative">
                <div id="btn-progress" class="absolute left-0 bottom-0 h-1 bg-white/20 transition-all duration-1000" style="width: 0%"></div>
                <span id="btn-icon" class="text-xl mb-1">üõ°Ô∏è</span>
                <span id="btn-text" class="text-sm font-black italic uppercase tracking-widest">DEPLOYED</span>
            </button>
        </div>
    </div>

    <!-- ADMIN PANEL (Hidden by default) -->
    <div id="admin-panel" class="fixed inset-x-0 bottom-0 z-[50] glass rounded-t-[3rem] p-8 panel-slide panel-hidden ui-element max-h-[85vh] overflow-y-auto">
        <div class="w-12 h-1.5 bg-zinc-800 rounded-full mx-auto mb-8"></div>
        
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black italic uppercase">Admin Command</h2>
            <button onclick="toggleAdminPanel()" class="text-zinc-500 font-bold">CLOSE</button>
        </div>

        <div id="admin-controls" class="space-y-6 hidden">
            <!-- Game Controls -->
            <div class="grid grid-cols-2 gap-4">
                <button onclick="toggleGame()" id="start-stop-btn" class="p-4 rounded-2xl bg-white text-black font-black uppercase italic text-sm">Start Match</button>
                <button onclick="resetServer()" class="p-4 rounded-2xl bg-red-900/30 text-red-500 font-black uppercase italic text-sm border border-red-500/20">Reset Server</button>
            </div>

            <!-- GPS Configuration -->
            <div class="space-y-3">
                <label class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Base Deployment (Click Map after selecting)</label>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="prepBase('A')" class="p-3 rounded-xl border border-blue-500/30 text-blue-500 text-[10px] font-bold uppercase">Set Alpha Base</button>
                    <button onclick="prepBase('B')" class="p-3 rounded-xl border border-orange-500/30 text-orange-500 text-[10px] font-bold uppercase">Set Bravo Base</button>
                </div>
            </div>

            <!-- Settings -->
            <div class="space-y-4 pt-4 border-t border-white/5">
                <div class="flex justify-between items-center">
                    <span class="text-xs font-bold text-zinc-400">Match Duration (min)</span>
                    <input type="number" id="input-time" onchange="updateSettings()" class="bg-zinc-900 w-16 p-2 rounded-lg text-center text-xs" value="10">
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-xs font-bold text-zinc-400">Respawn Time (sec)</span>
                    <input type="number" id="input-resp" onchange="updateSettings()" class="bg-zinc-900 w-16 p-2 rounded-lg text-center text-xs" value="30">
                </div>
            </div>
        </div>

        <div id="no-admin-view" class="text-center py-8">
            <p class="text-zinc-500 text-xs mb-4">You are not the mission commander.</p>
            <button onclick="takeAdmin()" class="px-8 py-3 bg-zinc-800 rounded-full text-[10px] font-black uppercase tracking-widest">Take Control</button>
        </div>
    </div>

    <script>
        // --- Firebase Config ---
        const firebaseConfig = {
            apiKey: "AIzaSyDhNuddcNUbKdvJoKvtkJtca4M4OPwabug",
            authDomain: "airsoft-hq-e9bcd.firebaseapp.com",
            projectId: "airsoft-hq-e9bcd",
            storageBucket: "airsoft-hq-e9bcd.firebasestorage.app",
            messagingSenderId: "645394629676",
            appId: "1:645394629676:web:1fb768d52a0152b125fd89"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const roomID = new URLSearchParams(window.location.search).get('r') || 'tactical_field_01';

        // --- State ---
        let map, myMarker, playerMarkers = {}, baseZones = { A: null, B: null };
        let userPos = null, basePrep = null;
        let localState = { adminId: null, players: {}, bases: { A: null, B: null }, time: 600, resp: 30, sA: 0, sB: 0, run: false };

        const userId = localStorage.getItem('as_id') || Math.random().toString(36).substring(7);
        localStorage.setItem('as_id', userId);
        const userName = localStorage.getItem('as_name') || "Operator";
        const userTeam = localStorage.getItem('as_team') || "A";

        // --- Initialization ---
        function initMap() {
            map = L.map('map', { zoomControl: false, attributionControl: false }).setView([31.7683, 35.2137], 18);
            
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}').addTo(map);

            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(updateLocation, handleLocError, {
                    enableHighAccuracy: true, maximumAge: 0, timeout: 5000
                });
            }

            map.on('click', (e) => {
                if(localState.adminId === userId && basePrep) {
                    localState.bases[basePrep] = { lat: e.latlng.lat, lng: e.latlng.lng };
                    basePrep = null;
                    sync();
                }
            });

            startListeners();
        }

        function updateLocation(pos) {
            userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
            document.getElementById('gps-indicator').className = "status-dot online";
            
            if(!myMarker) {
                myMarker = L.marker([userPos.lat, userPos.lng], { 
                    icon: L.divIcon({ className: 'user-pulse' }) 
                }).addTo(map);
                map.setView([userPos.lat, userPos.lng]);
            } else {
                myMarker.setLatLng([userPos.lat, userPos.lng]);
            }

            if(localState.players[userId]) {
                db.collection('airsoft_hq').doc(roomID).update({
                    [`players.${userId}.pos`]: userPos,
                    [`players.${userId}.ts`]: Date.now()
                });
            }
            checkGeofence();
        }

        function checkGeofence() {
            const myBase = localState.bases[userTeam];
            const distLabel = document.getElementById('distance-label');
            const alertBox = document.getElementById('geofence-alert');
            const btn = document.getElementById('main-btn');

            if(!myBase || !userPos) {
                distLabel.innerText = "BASE: NOT SET";
                return;
            }

            const dist = map.distance([userPos.lat, userPos.lng], [myBase.lat, myBase.lng]);
            distLabel.innerText = `BASE: ${Math.round(dist)}M`;

            const isDead = localState.players[userId]?.end > Date.now();
            if(isDead) {
                if(dist <= 25) { // 25m Radius
                    btn.classList.remove('is-locked');
                    btn.disabled = false;
                    alertBox.classList.add('hidden');
                    document.getElementById('btn-text').innerText = "RESPAWN READY";
                } else {
                    btn.classList.add('is-locked');
                    btn.disabled = true;
                    alertBox.classList.remove('hidden');
                    document.getElementById('btn-text').innerText = "GO TO BASE";
                }
            }
        }

        function startListeners() {
            db.collection('airsoft_hq').doc(roomID).onSnapshot(doc => {
                if(doc.exists) {
                    localState = doc.data();
                    refreshUI();
                } else {
                    localState.adminId = userId;
                    sync();
                }
            });

            // Join Logic
            db.collection('airsoft_hq').doc(roomID).update({
                [`players.${userId}`]: { name: userName, team: userTeam, end: 0, ts: Date.now(), pos: userPos || null }
            });

            // Heartbeat for online status
            setInterval(() => {
                if(localState.players[userId]) {
                    db.collection('airsoft_hq').doc(roomID).update({ [`players.${userId}.ts`]: Date.now() });
                }
            }, 8000);
        }

        function refreshUI() {
            const isAdmin = localState.adminId === userId;
            document.getElementById('admin-controls').classList.toggle('hidden', !isAdmin);
            document.getElementById('no-admin-view').classList.toggle('hidden', isAdmin);
            document.getElementById('player-label').innerText = (isAdmin ? "üëë " : "") + userName;
            
            document.getElementById('score-a').innerText = localState.sA;
            document.getElementById('score-b').innerText = localState.sB;

            const m = Math.floor(localState.time/60), s = localState.time%60;
            document.getElementById('display-timer').innerText = `${m}:${s<10?'0':''}${s}`;
            document.getElementById('game-status-label').innerText = localState.run ? "MISSION IN PROGRESS" : "MISSION PAUSED";

            // Render Players
            const now = Date.now();
            Object.entries(localState.players).forEach(([id, p]) => {
                if(id === userId) return;
                if(now - p.ts > 40000) {
                    if(playerMarkers[id]) { map.removeLayer(playerMarkers[id]); delete playerMarkers[id]; }
                    return;
                }
                if(!playerMarkers[id]) {
                    playerMarkers[id] = L.circleMarker([p.pos.lat, p.pos.lng], {
                        radius: 6, color: '#000', weight: 1, fillOpacity: 1,
                        fillColor: p.team === 'A' ? '#3b82f6' : '#f97316'
                    }).addTo(map).bindTooltip(p.name, { permanent: true, direction: 'top', className: 'bg-transparent border-none text-[8px] text-white shadow-none font-bold' });
                }
                if(p.pos) playerMarkers[id].setLatLng([p.pos.lat, p.pos.lng]);
                playerMarkers[id].setStyle({ fillOpacity: p.end > now ? 0.2 : 1 });
            });

            // Render Bases
            ['A', 'B'].forEach(t => {
                const b = localState.bases[t];
                if(b) {
                    if(!baseZones[t]) {
                        baseZones[t] = L.circle([b.lat, b.lng], {
                            radius: 25, color: t==='A'?'#3b82f6':'#f97316', weight: 2, fillOpacity: 0.15
                        }).addTo(map);
                    }
                    baseZones[t].setLatLng([b.lat, b.lng]);
                }
            });

            updateMainBtnState();
        }

        function updateMainBtnState() {
            const p = localState.players[userId];
            const btn = document.getElementById('main-btn');
            const now = Date.now();
            
            if(p.end > now) {
                btn.classList.add('is-dead');
                document.getElementById('btn-icon').innerText = "üíÄ";
                const timeLeft = Math.ceil((p.end - now) / 1000);
                document.getElementById('btn-progress').style.width = `${((p.end - now) / (localState.resp * 1000)) * 100}%`;
                checkGeofence();
            } else {
                btn.classList.remove('is-dead', 'is-locked');
                btn.disabled = false;
                document.getElementById('btn-icon').innerText = "üõ°Ô∏è";
                document.getElementById('btn-text').innerText = "DEPLOYED";
                document.getElementById('btn-progress').style.width = "0%";
                document.getElementById('geofence-alert').classList.add('hidden');
            }
        }

        // --- Interactions ---
        document.getElementById('main-btn').onclick = () => {
            const now = Date.now();
            const p = localState.players[userId];
            if(p.end > now) {
                p.end = 0;
            } else {
                p.end = now + (localState.resp * 1000);
                if(userTeam === 'A') localState.sB++; else localState.sA++;
            }
            sync();
        };

        function toggleAdminPanel() { document.getElementById('admin-panel').classList.toggle('panel-hidden'); }
        function takeAdmin() { localState.adminId = userId; sync(); }
        function toggleGame() { localState.run = !localState.run; sync(); }
        function resetServer() {
            if(!confirm("Reset everything? Scores, map bases and players?")) return;
            localState = { adminId: userId, players: {}, bases: { A: null, B: null }, time: 600, resp: 30, sA: 0, sB: 0, run: false };
            sync();
        }
        function prepBase(t) { basePrep = t; toggleAdminPanel(); alert(`Click anywhere on the map to set Team ${t} Base`); }
        function updateSettings() {
            localState.time = document.getElementById('input-time').value * 60;
            localState.resp = document.getElementById('input-resp').value;
            sync();
        }
        function sync() { db.collection('airsoft_hq').doc(roomID).set(localState); }
        function handleLocError(e) { console.warn("GPS Error", e); }

        window.onload = initMap;
    </script>
</body>
</html>

= state.players[state.adminId] && (Date.now() - state.players[state.adminId].lastSeen < 15000);

            if(isAdmin) document.body.classList.add('is-admin'); 
            else document.body.classList.remove('is-admin');

            document.getElementById('btnClaimAdmin').classList.toggle('hidden', isAdmin || adminActive);

            const myP = state.players[userLocal.id];
            document.getElementById('userLabel').innerText = (isAdmin ? "üëë " : "") + userLocal.name;
            document.getElementById('userLabel').className = `text-[10px] font-black uppercase italic ${myP?.team==='A'?'text-blue-500':'text-orange-500'}`;

            renderGrids(isAdmin);
        }

        function renderGrids(isAdmin) {
            const alpha = document.getElementById('gridAlpha');
            const bravo = document.getElementById('gridBravo');
            alpha.innerHTML = ''; bravo.innerHTML = '';
            const now = Date.now();

            Object.entries(state.players).forEach(([id, p]) => {
                const isDead = p.end > now;
                const isMe = id === userLocal.id;
                const card = document.createElement('div');
                card.dataset.id = id;
                card.className = `player-card glass ${isDead?'is-dead':''} ${isMe?'is-me':''} ${!state.run?'opacity-50':''}`;
                
                if(isDead) {
                    const sec = Math.ceil((p.end - now)/1000);
                    card.innerHTML = `<span class="text-3xl font-black italic tabular-nums">${sec}</span><span class="text-[8px] uppercase opacity-40">${p.name} (${p.hits || 0})</span>`;
                } else {
                    card.innerHTML = `
                        <div class="absolute top-2 right-3 text-[9px] font-black opacity-30 italic tabular-nums">${p.hits || 0} HITS</div>
                        <span class="font-black text-sm uppercase ${p.team==='A'?'text-blue-500':'text-orange-500'}">${p.name}</span>
                        ${isAdmin ? '<div class="mt-1 text-[7px] font-bold text-zinc-500 border border-zinc-800 px-1.5 rounded edit-btn">SQUAD LEAD</div>' : ''}
                    `;
                }

                card.onclick = (e) => {
                    if(e.target.classList.contains('edit-btn')) { openEdit(id); return; }
                    if(!isMe || !state.run || isDead) return;
                    p.end = Date.now() + (state.resp * 1000);
                    p.hits = (p.hits || 0) + 1;
                    if(p.team === 'A') state.sB++; else state.sA++;
                    sync();
                };

                if(p.team === 'A') alpha.appendChild(card); else bravo.appendChild(card);
            });

            if(isAdmin) setupSortable();
        }

        function setupSortable() {
            const opt = { group: 'players', animation: 150, ghostClass: 'drag-ghost', onEnd: (e) => {
                const id = e.item.dataset.id;
                const newT = e.to.id === 'gridAlpha' ? 'A' : 'B';
                if(state.players[id].team !== newT) { state.players[id].team = newT; sync(); }
            }};
            if(!window.sA) window.sA = Sortable.create(document.getElementById('gridAlpha'), opt);
            if(!window.sB) window.sB = Sortable.create(document.getElementById('gridBravo'), opt);
        }

        window.openEdit = (id) => {
            editingPlayerId = id;
            document.getElementById('editPlayerName').value = state.players[id].name;
            document.getElementById('editPlayerTeam').value = state.players[id].team;
            document.getElementById('editModal').classList.remove('hidden');
        };
        window.closeEdit = () => document.getElementById('editModal').classList.add('hidden');
        window.saveEdit = () => {
            state.players[editingPlayerId].name = document.getElementById('editPlayerName').value;
            state.players[editingPlayerId].team = document.getElementById('editPlayerTeam').value;
            sync(); closeEdit();
        };
        window.kickPlayer = () => {
            if(confirm("Kick player?")) { delete state.players[editingPlayerId]; sync(); closeEdit(); }
        };

        window.applySettings = () => {
            const roomN = document.getElementById('newRoomName').value.trim();
            const resp = parseInt(document.getElementById('setRespTime').value);
            const match = parseInt(document.getElementById('setMatchTime').value);
            
            state.resp = resp || 30;
            state.time = (match || 10) * 60;
            sync();

            if(roomN && roomN.toLowerCase() !== roomID) {
                window.location.search = `?r=${roomN.toLowerCase().replace(/\s+/g, '_')}`;
            } else {
                document.getElementById('roomDialog').classList.add('hidden');
            }
        };

        window.hardResetRoom = () => {
            if(confirm("◊õ◊ú ◊î◊†◊™◊ï◊†◊ô◊ù ◊ï◊î◊©◊ó◊ß◊†◊ô◊ù ◊ô◊ô◊û◊ó◊ß◊ï ◊û◊î◊ó◊ì◊®. ◊ë◊ò◊ï◊ó?")) {
                state.players = {}; state.history = [];
                state.sA = 0; state.sB = 0; state.time = 600; state.run = false;
                state.adminId = userLocal.id;
                sync();
                window.location.reload();
            }
        };

        function sync() { state.ts = Date.now(); db.collection('airsoft_arena').doc(roomID).set(state); }

        window.toggleHistory = () => {
            const p = document.getElementById('historyPanel');
            if(p.classList.contains('hidden')) {
                const list = document.getElementById('historyList'); list.innerHTML = '';
                if(state.history.length === 0) document.getElementById('noHistory').classList.remove('hidden');
                else {
                    document.getElementById('noHistory').classList.add('hidden');
                    state.history.slice().reverse().forEach(h => {
                        const div = document.createElement('div');
                        div.className = "glass p-6 rounded-3xl border-white/5";
                        let stats = Object.values(h.playerData || {}).map(ps => `<div class="flex justify-between text-[11px] border-b border-white/5 py-1">
                                <span class="${ps.team==='A'?'text-blue-500':'text-orange-500'}">${ps.name}</span>
                                <span class="text-zinc-500">${ps.hits} Hits</span></div>`).join('');
                        div.innerHTML = `<div class="flex justify-between mb-4"><span class="text-xs font-black text-zinc-600">RND ${h.round}</span>
                                <span class="text-[10px] font-black uppercase ${h.winner==='ALPHA'?'text-blue-500':'text-orange-500'}">${h.winner} WIN</span></div>
                                <div class="flex justify-around mb-4 text-2xl font-black italic"><span>${h.sA}</span><span class="text-zinc-800 text-sm italic">VS</span><span>${h.sB}</span></div>
                                <div class="bg-black/40 rounded-xl p-3">${stats}</div>`;
                        list.appendChild(div);
                    });
                }
            }
            p.classList.toggle('hidden');
        };

        window.endRound = () => {
            if(!confirm("◊°◊ô◊ô◊ù ◊°◊ô◊ë◊ï◊ë ◊ï◊©◊û◊ï◊® ◊ì◊ï''◊ó ◊ß◊®◊ë?")) return;
            const w = state.sA > state.sB ? 'ALPHA' : (state.sB > state.sA ? 'BRAVO' : 'DRAW');
            const pData = {}; Object.entries(state.players).forEach(([id, p]) => pData[id] = { name: p.name, team: p.team, hits: p.hits });
            state.history.push({ round: state.history.length+1, sA: state.sA, sB: state.sB, winner: w, playerData: pData });
            resetStats(false); toggleHistory();
        };

        window.resetStats = (ask=true) => {
            if(ask && !confirm("◊ê◊ô◊§◊ï◊° ◊™◊ï◊¶◊ê◊ï◊™ ◊ï◊ñ◊û◊†◊ô◊ù?")) return;
            state.sA = 0; state.sB = 0; state.run = false;
            Object.values(state.players).forEach(p => { p.end = 0; p.hits = 0; });
            sync();
        };

        window.copyShareLink = () => {
            const t = document.createElement('textarea'); t.value = window.location.href; document.body.appendChild(t);
            t.select(); document.execCommand('copy'); document.body.removeChild(t); alert("Room link copied!");
        };

        document.getElementById('btnMainToggle').onclick = () => { if(state.adminId===userLocal.id){ state.run=!state.run; sync(); }};

        setInterval(() => {
            if(state.run && state.time > 0) {
                state.time--;
                if(state.time === 0) endRound();
                render();
            }
            // Update presence & periodic sync
            if(state.players[userLocal.id]) {
                state.players[userLocal.id].lastSeen = Date.now();
                if(Date.now() % 5000 < 1000) sync();
            }
        }, 1000);

        window.onload = () => {
            document.getElementById('setRespTime').value = state.resp;
            document.getElementById('setMatchTime').value = state.time / 60;
        };
    </script>
</body>
</html>

